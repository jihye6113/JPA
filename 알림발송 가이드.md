# 알림발송 가이드

작성일시: 2024년 7월 19일 오전 9:52
프로젝트: 경희사이버대
적용한 업무(화면): 메시지보내기팝업, 발송문양식관리, 통합메시지발송
가이드경로: C:\eXCampus_khcu\KHCU_DOC\02.개발\01.준비(설계)\05.아키텍쳐및개발표준정의\02.개발표준정의

## 개발자 체크항목

1. 알림발송 종류(알림톡/문자/이메일)
2. 알림발송 용도(관리자/개인/그룹전송)
3. 알림발송 방식(팝업/내부발송/그룹전송)

💡 알림발송 목적에 따라 속성값 세팅이 달라진다.


## 알림발송 개발 흐름

- 알림톡 정보확인 (설계자 확인 필요)
    1.  발송구분 체크 : 알림톡/문자/이메일
    2.  전송방법 체크 : 팝업 사용 / 내부발송 
    3. 발송문 ID[CMN014 ]등록 : 알림발송인 경우 / 발송문양식 사용하는 경우 → 필수
    4. 발송문양식 확인 (치환문구 사용여부 확인)
- 발송문 양식 등록 
-  경로 → [공통>통합메시징>SMS/E-MAIL 발송문관리]
    - 전송하려는 알림문 유형에 따라 개발자가 항목 입력 후 저장
        - 알림톡 : 치환항목 고정
        - 이메일 : 통계연계코드, 통계분류코드 필수
        - 알림톡, 이메일인 경우  
        발신자전화번호 : 02-2051-9857 테스트 번호 → 다른번호시 전송 불가
        - 치환항목 사용시 
        치환항목 : 명칭
        발송문내용에 치환항목사용시 #{} 안에 치환항목 작성 
        ex) 치환항목 : 부서명 → 발송문 : #{부서명}입니다.
    
    💡 알림톡 양식을 추가로 원하는 경우 설계자가 통합메시지 솔루션에 등록하면 반나절 후에 승인이 나면 사용가능 
    (개발시 먼저 등록 요청)
    
    
- 내부발송
    - 내부발송이란? 
    업무단 서버에서 직접 발송 : [P_CMN_INF_SEND_DIR] 프로시져사용
    - 서버단 작업
    1. 발송문 그룹번호 채번 : 오라클 시퀀스 SQ_SND_MSGG_KEY.NEXTVAL 
    2. [P_CMN_INF_SEND_DIR] 프로시져 호출
    3. 후처리 → 각 업무단 처리 
    
- 통합메시지 보내기 팝업 [udcExtCmnPSmsEmailMsgSend]
    - 호출 화면단에서 사용할 그리드에 기본정보가 있어야 한다. (필수는 아님)
    ex) 이름, 사용자구분, 오브젝트번호, 휴대폰번호, 이메일 주소
    - 필요한 알림발송 기능에 맞게 속성 값 설정

## 알림발송 전달사항 (상세)

- ‘재외국인’ 인 경우 무조건 이메일로 발송 - 이메일주소 필수 → 알림톡/문자 발송이어도 수신자이메일 주소 필수로 넣어줘야 한다.
- 사용자정보(휴대폰번호, 이메일 주소)는 [VW_CMN_INF_CTTP] 뷰를 사용하여 가져온다.
→ 학생인 경우 수신동의한 메일주소정보를 가져온다. (2개이면 2개의 행을 만들어준다.)
- 메일/휴대폰 정보가 null 이어도 전송은 하지만, 전송은 실패. 
→ 실패정보는 결과조회 화면에서 확인 후 재발송 가능하다.